<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>店面選址專業評估 | 星橋創媒</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/assessment.css') }}?v=3.2">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pdf_export.css') }}?v=3.2">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdns.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <!-- Chart.js for Dashboard -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <!-- html2pdf.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/dashboard_renderer_v2.js') }}?v=5.1"></script>
    <script src="{{ url_for('static', filename='js/assessment.js') }}?v=5.1"></script>
</head>

<body>
    <div class="background-mesh"></div>

    <header class="app-header">
        <div class="logo-container">
            <img src="{{ url_for('static', filename='img/logo_header.png') }}" alt="Logo" class="logo-img">
            <div class="logo-text">
                <h1>Star Bridge</h1>
                <span>智能選址評估系統</span>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="intro-section">
            <h2>店面選址專業評估表單</h2>
            <p>請輸入您的開店計畫資訊，我們的 AI 系統將為您進行多維度數據分析，並生成專業評估報告。</p>
        </div>

        <form id="assessmentForm" class="glass-panel">
            <!-- Hidden Fields for Google Form Entry IDs (Configured in JS) -->

            <div class="form-section">
                <h3><i class="fa-solid fa-store"></i> 基本選址資料</h3>
                <div class="grid-2">
                    <div class="form-group">
                        <label for="address">店面地址 <span class="required">*</span></label>
                        <input type="text" id="address" name="address" required placeholder="例如：台北市中山區松江路111號">
                    </div>
                    <div class="form-group">
                        <label for="industryType">產業類型 <span class="required">*</span></label>
                        <select id="industryType" name="industryType" required>
                            <option value="">請選擇...</option>
                            <option value="咖啡廳">咖啡廳</option>
                            <option value="火鍋店">火鍋店</option>
                            <option value="早午餐">早午餐</option>
                            <option value="手搖飲">手搖飲</option>
                            <option value="居酒屋/餐酒館">居酒屋/餐酒館</option>
                            <option value="拉麵/日式定食">拉麵/日式定食</option>
                            <option value="美髮沙龍">美髮沙龍</option>
                            <option value="零售店面">零售店面</option>
                            <option value="其他">其他 (請自行輸入)</option>
                        </select>
                        <input type="text" id="industryTypeOther" name="industryTypeOther" class="hidden mt-2"
                            placeholder="請輸入您的產業類型">
                    </div>
                    <div class="form-group">
                        <label for="areaSize">店面坪數 (坪) <span class="required">*</span></label>
                        <input type="number" id="areaSize" name="areaSize" required min="1" step="0.5">
                    </div>
                    <div class="form-group">
                        <label for="avgConsumption">預計客單價 (元) <span class="required">*</span></label>
                        <input type="number" id="avgConsumption" name="avgConsumption" required min="0" step="10">
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3><i class="fa-solid fa-chart-line"></i> 商業決策資料</h3>
                <div class="grid-2">
                    <div class="form-group">
                        <label for="targetCustomers">目標客群</label>
                        <input type="text" id="targetCustomers" name="targetCustomers" placeholder="例如：25-35歲上班族、家庭客">
                    </div>
                    <div class="form-group">
                        <label for="businessHours">預期營業時間</label>
                        <input type="text" id="businessHours" name="businessHours" placeholder="例如：每日 11:00 - 21:00">
                    </div>
                </div>
            </div>

            <!-- Contact Info Hidden by User Request -->
            <div class="form-section" style="display: none;">
                <h3><i class="fa-regular fa-id-card"></i> 聯絡資訊</h3>
                <div class="grid-2">
                    <div class="form-group">
                        <label for="contactName">聯絡人姓名</label>
                        <input type="text" id="contactName" name="contactName" value="Guest">
                    </div>
                    <div class="form-group">
                        <label for="contactEmail">電子信箱 <span class="required">*</span></label>
                        <input type="email" id="contactEmail" name="contactEmail" value="guest@example.com" required
                            placeholder="接收報告用">
                    </div>
                </div>
            </div>

            <div class="action-bar">
                <button type="button" id="btnSubmitGoogle" class="btn secondary">
                    <i class="fa-brands fa-google"></i> 僅提交資料
                </button>
                <button type="submit" id="btnGenerateReport" class="btn primary">
                    <i class="fa-solid fa-wand-magic-sparkles"></i> 提交並生成專業報告
                </button>
            </div>
        </form>

        <!-- Loading Overlay -->
        <div id="loadingOverlay" class="hidden">
            <div class="spinner-container">
                <div class="spinner"></div>
                <p>正在分析商圈大數據...</p>
                <ul class="loading-steps">
                    <li id="step1" class="step pending">連接地理資訊系統</li>
                    <li id="step2" class="step pending">分析周邊競品與人流</li>
                    <li id="step3" class="step pending">生成財務預測模型</li>
                    <li id="step4" class="step pending">產出專業評估報告</li>
                </ul>
            </div>
        </div>

        <!-- Result Section -->
        <div id="resultSection" class="hidden glass-panel">
            <div class="result-header">
                <h3><i class="fa-solid fa-check-circle"></i> 評估報告已生成</h3>
                <div class="result-actions">
                    <button type="button" class="btn download-btn js-download-pdf">
                        <i class="fa-solid fa-file-pdf"></i> 下載 PDF 報告
                    </button>
                    <!-- Image Download Removed -->
                    <button type="button" class="btn secondary js-reload-btn" onclick="window.location.reload()">
                        <i class="fa-solid fa-rotate-right"></i> 重新評估
                    </button>
                </div>
            </div>
            <div id="reportPreview" class="report-preview">
                <!-- DASHBOARD TEMPLATE START (使用者可調整版型區域) -->
                <!-- 使用 CSS Grid 確保版面穩固 -->
                <style>
                    /* 專用樣式 - 可在此直接調整版面 */
                    .dashboard-container {
                        display: flex;
                        flex-direction: column;
                        gap: 25px;
                        padding: 20px;
                        background: #fdfdfd;
                    }

                    /* 頭部區塊：左評分、右地圖 */
                    .header-grid {
                        display: grid;
                        /* [可調整] 300px 是左側評分卡寬度，1fr 是右側地圖自動填滿 */
                        grid-template-columns: 250px 1fr;

                        gap: 20px;
                        /* [可調整] 頂部區域高度，影響圓環與地圖的高度 */
                        height: 250px;
                    }

                    @media (max-width: 768px) {
                        .header-grid {
                            grid-template-columns: 1fr;
                            height: auto;
                        }
                    }

                    /* 卡片通用樣式 */
                    .dash-card {
                        background: #fff;
                        border-radius: 12px;
                        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.06);
                        overflow: hidden;
                        position: relative;
                    }

                    /* 評分卡內容置中 */
                    .score-card-content {
                        height: 100%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        position: relative;
                    }

                    /* 地圖填滿 */
                    .map-fill {
                        width: 100%;
                        height: 100%;
                        object-fit: cover;
                        display: block;
                    }

                    /* 數據網格 (4格) */
                    /* 數據網格 (4格) - 強制控制 */
                    .metrics-grid {
                        display: grid;
                        grid-template-columns: repeat(4, 1fr);
                        /* Desktop: 4 in a row */
                        gap: 15px;
                    }

                    /* RWD: Tablet -> 2x2 */
                    @media (max-width: 1100px) {
                        .metrics-grid {
                            grid-template-columns: repeat(2, 1fr);
                        }
                    }

                    /* RWD: Mobile -> 1x4 */
                    @media (max-width: 600px) {
                        .metrics-grid {
                            grid-template-columns: 1fr;
                        }
                    }

                    .metric-box {
                        background: #fff;
                        padding: 15px;
                        border-radius: 10px;
                        text-align: center;
                        border-left: 4px solid #ff7e33;
                        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
                        /* Vertical Center */
                        display: flex;
                        flex-direction: column;
                        justify-content: center;
                        align-items: center;
                        min-height: 120px;
                    }

                    /* Analysis Box Specifics */
                    .analysis-box {
                        text-align: left !important;
                        /* Force container left */
                    }

                    .analysis-title {
                        text-align: left;
                        display: flex;
                        align-items: center;
                        gap: 10px;
                    }

                    .analysis-content,
                    .analysis-content p,
                    .analysis-content div,
                    .analysis-content li {
                        line-height: 1.8;
                        color: #444;
                        white-space: pre-line;
                        text-align: left !important;
                        /* Fix: Force left alignment strictly */
                    }

                    .charts-grid {
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 20px;
                    }

                    @media (max-width: 900px) {
                        .charts-grid {
                            grid-template-columns: 1fr;
                        }
                    }

                    .chart-box {
                        background: #fff;
                        padding: 20px;
                        border-radius: 12px;
                        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.06);
                        min-height: 350px;
                    }
                </style>

                <!-- 實際 HTML 結構 (ID 用於 JS 填入數據) -->
                <div id="dashboard-layout" class="dashboard-container">

                    <!-- 1. 頭部: 評分與地圖 -->
                    <div class="header-grid">
                        <!-- 左側: 評分 -->
                        <div class="dash-card">
                            <div class="score-card-content">
                                <canvas id="scoreChart"></canvas>
                                <!-- [可調整] 絕對置中數值位置 -->
                                <div
                                    style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -45%); text-align: center; pointer-events: none; width: 100%;">
                                    <div id="val-score"
                                        style="font-size: 5rem; font-weight: 700; color: #ff7e33; line-height: 1.1; margin-bottom: 5px;">
                                        -
                                    </div>
                                    <div style="font-size: 1.2rem; color: #888; font-weight: 500;">綜合評分</div>
                                </div>
                            </div>
                        </div>

                        <!-- 右側: 地圖 (JS 將替換 src)-->
                        <div class="dash-card">
                            <!-- 預設顯示載入中 -->
                            <div id="map-container"
                                style="width: 100%; height: 100%; min-height: 300px; background: #f8f9fa; display: flex; align-items: center; justify-content: center; color: #999; border-radius: 12px; overflow: hidden;">
                                <img id="val-map-img" src="" class="map-fill hidden" style="display:none;"
                                    crossorigin="anonymous">
                                <span id="map-placeholder"><i class="fa-solid fa-map-location-dot"></i> 地圖載入中...</span>
                            </div>
                        </div>
                    </div>

                    <!-- 2. AI 總結 -->
                    <div class="dash-card" style="padding: 25px;">
                        <h3
                            style="margin-top: 0; color: #2c3e50; border-bottom: 2px solid #ff7e33; padding-bottom: 10px; margin-bottom: 15px;">
                            <i class="fa-solid fa-robot"></i> AI 選址評估總結
                        </h3>
                        <div
                            style="background: #fff4e6; padding: 12px; margin-bottom: 20px; border-radius: 8px; font-size: 0.95rem; display: flex; justify-content: space-between; align-items: center;">
                            <span><i class="fa-solid fa-sliders"></i> 設定條件：<strong id="val-user-target">-</strong> |
                                <strong id="val-user-hours">-</strong></span>
                            <span style="font-size: 0.8rem; color: #888;">AI 生成時間：剛剛</span>
                        </div>
                        <div id="val-summary"
                            style="line-height: 1.8; color: #444; font-size: 1.05rem; text-align: left !important;">
                            (等待評估結果...)
                        </div>
                    </div>

                    <!-- 3. 關鍵數據 (4格) -->
                    <div class="metrics-grid">
                        <div class="metric-box">
                            <div style="color: #666; font-size: 0.95rem; margin-bottom: 5px; white-space: nowrap;">預估月營收
                            </div>
                            <div id="val-revenue" style="font-size: 1.8rem; font-weight: 800; color: #2c3e50;">-</div>
                        </div>
                        <div class="metric-box">
                            <div style="color: #666; font-size: 0.95rem; margin-bottom: 5px; white-space: nowrap;">預估翻桌率
                            </div>
                            <div id="val-turnover" style="font-size: 1.8rem; font-weight: 800; color: #34495e;">-</div>
                        </div>
                        <div class="metric-box">
                            <div style="color: #666; font-size: 0.95rem; margin-bottom: 5px; white-space: nowrap;">
                                預估回本週期 (月)</div>
                            <div id="val-roi" style="font-size: 1.8rem; font-weight: 800; color: #27ae60;">-</div>
                        </div>
                        <div class="metric-box">
                            <div style="color: #666; font-size: 0.95rem; margin-bottom: 5px; white-space: nowrap;">
                                每日客流預估</div>
                            <div id="val-traffic" style="font-size: 1.8rem; font-weight: 800; color: #e67e22;">-</div>
                        </div>
                    </div>

                    <!-- 4. 圖表區 -->
                    <div class="charts-grid">
                        <div class="chart-box">
                            <h4 style="text-align: center; margin-bottom: 15px;">商圈五力分析</h4>
                            <div style="height: 300px;"><canvas id="radarChart"></canvas></div>
                        </div>
                        <div class="chart-box">
                            <h4 style="text-align: center; margin-bottom: 15px;">財務預測損益</h4>
                            <div style="height: 300px;"><canvas id="financeChart"></canvas></div>
                        </div>
                        <div class="chart-box">
                            <h4 style="text-align: center; margin-bottom: 15px;">成本結構分析</h4>
                            <div style="height: 300px;"><canvas id="costChart"></canvas></div>
                        </div>
                        <div class="chart-box">
                            <h4 style="text-align: center; margin-bottom: 15px;">人口年齡分佈</h4>
                            <div style="height: 300px;"><canvas id="ageChart"></canvas></div>
                        </div>
                    </div>

                    <!-- 5. 詳細分析區 (單欄堆疊) -->
                    <style>
                        .analysis-box {
                            background: #fff;
                            border-radius: 12px;
                            padding: 25px;
                            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.06);
                            margin-bottom: 20px;
                        }

                        .analysis-title {
                            color: #2c3e50;
                            border-bottom: 2px solid #eee;
                            padding-bottom: 10px;
                            margin-bottom: 15px;
                            font-size: 1.2rem;
                            display: flex;
                            align-items: center;
                            gap: 10px;
                        }

                        .analysis-content,
                        .analysis-content p,
                        .analysis-content div,
                        .analysis-content li {
                            line-height: 1.8 !important;
                            font-size: 1.05rem !important;
                            color: #34495e !important;
                            letter-spacing: 0.02em !important;
                            text-align: left !important;
                        }
                    </style>

                    <div class="analysis-section">
                        <!-- 微觀人口 -->
                        <div class="analysis-box">
                            <h4 class="analysis-title"><i class="fa-solid fa-users-viewfinder"
                                    style="color:#e74c3c;"></i> 微觀人口與消費力分析</h4>
                            <div id="val-pop-body" class="analysis-content">分析中...</div>
                        </div>

                        <!-- 區域租金 -->
                        <div class="analysis-box">
                            <h4 class="analysis-title"><i class="fa-solid fa-shop-lock" style="color:#f39c12;"></i>
                                區域租金行情與門檻</h4>
                            <div id="val-rent-body" class="analysis-content">分析中...</div>
                        </div>

                        <!-- 市場競爭 -->
                        <div class="analysis-box">
                            <h4 class="analysis-title"><i class="fa-solid fa-chess-rook" style="color:#3498db;"></i>
                                市場競爭態勢分析</h4>
                            <div id="val-comp-body" class="analysis-content">分析中...</div>
                        </div>

                        <!-- 生活機能 -->
                        <div class="analysis-box">
                            <h4 class="analysis-title"><i class="fa-solid fa-train-subway" style="color:#2ecc71;"></i>
                                生活機能與交通節點</h4>
                            <div id="val-func-body" class="analysis-content">分析中...</div>
                        </div>

                        <!-- 空間規劃 -->
                        <div class="analysis-box">
                            <h4 class="analysis-title"><i class="fa-solid fa-compass-drafting"
                                    style="color:#9b59b6;"></i> 空間規劃與坪效優化</h4>
                            <div id="val-space-body" class="analysis-content">分析中...</div>
                        </div>

                        <!-- 財務建議 -->
                        <div class="analysis-box">
                            <h4 class="analysis-title"><i class="fa-solid fa-file-invoice-dollar"
                                    style="color:#34495e;"></i> 財務風險與投資建議</h4>
                            <div id="val-fin-body" class="analysis-content">分析中...</div>
                        </div>

                        <!-- 行銷建議 -->
                        <div class="analysis-box">
                            <h4 class="analysis-title"><i class="fa-solid fa-bullhorn" style="color:#e67e22;"></i>
                                行銷策略與獲客建議</h4>
                            <div id="val-mkt-body" class="analysis-content">分析中...</div>
                        </div>

                        <!-- 總結 -->
                        <div class="analysis-box" style="border-left: 5px solid #ff7e33;">
                            <h4 class="analysis-title"><i class="fa-solid fa-clipboard-check"
                                    style="color:#ff7e33;"></i> 最終評估結論</h4>
                            <div id="val-conclusion" class="analysis-content">分析中...</div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Bottom Actions (Duplicated for User Convenience) -->
            <div class="result-actions bottom-actions"
                style="margin-top: 40px; display: flex; justify-content: center; gap: 20px; padding-bottom: 40px; border-top: 1px solid #eee; padding-top: 30px;">
                <button type="button" class="btn download-btn js-download-pdf">
                    <i class="fa-solid fa-file-pdf"></i> 下載 PDF 報告
                </button>
                <button type="button" class="btn secondary js-reload-btn" onclick="window.location.reload()">
                    <i class="fa-solid fa-rotate-right"></i> 重新評估
                </button>
            </div>
        </div>
        </div>

    </main>

</body>

</html>